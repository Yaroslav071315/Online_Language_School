@model IEnumerable<Online_Language_School.Models.Lesson>

<h4 class="mb-3">📚 Lessons Management</h4>

<!-- Accordion для Create/Edit -->
<div class="accordion mb-4" id="lessonAccordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingCreateLesson">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCreateLesson">
                ➕ Add Lesson
            </button>
        </h2>
        <div id="collapseCreateLesson" class="accordion-collapse collapse show" data-bs-parent="#lessonAccordion">
            <div class="accordion-body">
                <form asp-action="CreateLesson" asp-controller="Teacher" method="post" class="border p-3 rounded bg-light mb-4">
                    <div class="row g-2 mb-2">
                        <div class="col-6"><input name="title" class="form-control" placeholder="Lesson Title" required /></div>
                        <div class="col-6"><input name="orderNumber" type="number" class="form-control" placeholder="Order Number" /></div>
                    </div>
                    <div class="mb-2"><textarea name="description" class="form-control" placeholder="Description"></textarea></div>
                    <div class="row g-2 mb-2">
                        <div class="col-6"><input name="scheduledDate" type="datetime-local" class="form-control" /></div>
                        <div class="col-6"><input name="durationMinutes" type="number" class="form-control" placeholder="Duration (min)" /></div>
                    </div>
                    <div class="mb-2"><input name="courseId" type="number" class="form-control" placeholder="Course Id" required /></div>
                    <button type="submit" class="btn btn-success">✅ Save Lesson</button>
                </form>
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <h2 class="accordion-header" id="headingEditLesson">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditLesson">
                ✏️ Edit Lesson
            </button>
        </h2>
        <div id="collapseEditLesson" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
            <div class="accordion-body">
                <form asp-action="EditLesson" asp-controller="Teacher" method="post" class="border p-3 rounded bg-light mb-4">
                    <div class="mb-2">
                        <select name="id" class="form-select" required>
                            <option value="">-- Select Lesson --</option>
                            @foreach (var lesson in ViewBag.Lessons as List<Online_Language_School.Models.Lesson>)
                            {
                                <option value="@lesson.Id">@lesson.Title (@lesson.ScheduledDate?.ToString("yyyy-MM-dd HH:mm"))</option>
                            }
                        </select>
                    </div>
                    <div class="row g-2 mb-2">
                        <div class="col-6"><input name="title" class="form-control" placeholder="Lesson Title" required /></div>
                        <div class="col-6"><input name="orderNumber" type="number" class="form-control" placeholder="Order Number" /></div>
                    </div>
                    <div class="mb-2"><textarea name="description" class="form-control" placeholder="Description"></textarea></div>
                    <div class="row g-2 mb-2">
                        <div class="col-6"><input name="scheduledDate" type="datetime-local" class="form-control" /></div>
                        <div class="col-6"><input name="durationMinutes" type="number" class="form-control" placeholder="Duration (min)" /></div>
                    </div>
                    <div class="mb-2"><input name="courseId" type="number" class="form-control" placeholder="Course Id" required /></div>
                    <button type="submit" class="btn btn-warning">💾 Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>

<h4 class="mb-3">📚 List of Classes</h4>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Date & Time</th>
            <th>Course</th>
            <th>Title</th>
            <th>Description</th>
            <th>Duration</th>
            <th>Order</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var lesson in Model)
        {
            <tr>
                <td>@(lesson.ScheduledDate?.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
                <td>@lesson.Course?.Title (@lesson.CourseId)</td>
                <td>@lesson.Title</td>
                <td>@lesson.Description</td>
                <td>@lesson.DurationMinutes min</td>
                <td>@lesson.OrderNumber</td>
                <td>
                    <!-- View button -->
                    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#viewLesson-@lesson.Id">
                        👁 View
                    </button>

                    <form asp-action="DeleteLesson" asp-controller="Teacher" method="post" class="d-inline">
                        <input type="hidden" name="id" value="@lesson.Id" />
                        <button type="submit" class="btn btn-sm btn-danger">🗑 Delete</button>
                    </form>
                </td>
            </tr>

            <!-- Modal with Bootstrap Card -->
            <div class="modal fade" id="viewLesson-@lesson.Id" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">@lesson.Title</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Course: @lesson.Course?.Title</h5>
                                    <p class="card-text">@lesson.Description</p>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item">Scheduled: @(lesson.ScheduledDate?.ToString("yyyy-MM-dd HH:mm") ?? "-")</li>
                                        <li class="list-group-item">Duration: @lesson.DurationMinutes min</li>
                                        <li class="list-group-item">Order: @lesson.OrderNumber</li>
                                        <li class="list-group-item">Course Id: @lesson.CourseId</li>
                                        <li class="list-group-item">Lesson Id: @lesson.Id</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </tbody>
</table>

<h4 class="mb-3">📅 Calendar</h4>
<div class="border p-3 text-center">
    <table class="table table-bordered text-center">
        <thead>
            <tr>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
                <th>Sun</th>
            </tr>
        </thead>
        <tbody>
            @{
                var startOfMonth = new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1);
                var daysInMonth = DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month);
                var currentDay = 1;
                var firstDayOfWeek = (int)startOfMonth.DayOfWeek;
                if (firstDayOfWeek == 0) firstDayOfWeek = 7; // неділя = 7
                for (int row = 0; row < 6; row++)
                {
                            <tr>
                        @for (int col = 1; col <= 7; col++)
                        {
                            if ((row == 0 && col < firstDayOfWeek) || currentDay > daysInMonth)
                            {
                                                <td></td>
                            }
                            else
                            {
                                var date = new DateTime(DateTime.Now.Year, DateTime.Now.Month, currentDay);
                                var hasLesson = Model.Any(l => l.ScheduledDate.HasValue && l.ScheduledDate.Value.Date == date.Date);
                                                <td class="@(hasLesson ? "bg-success text-white" : "")">
                                    @currentDay
                                                </td>
                                ;
                                currentDay++;
                            }
                        }
                            </tr>
                }
            }
        </tbody>
    </table>
</div>
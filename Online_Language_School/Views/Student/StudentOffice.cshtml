@{
    ViewData["Title"] = "Student Office";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <!-- Ліва панель -->
        <nav class="col-2 bg-light border-end"
             style="position:fixed; top:0; left:0; height:100vh; overflow-y:auto; padding:20px;">
            <h5>Menu</h5>
            <ul class="nav flex-column nav-pills">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#schedule">Schedule</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#materials">Materials</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#progress">Progress</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#payments">Payments</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#chat">Chat</a></li>
            </ul>
            <hr />
            <footer class="small text-center">
                <p>📞 info@languageschool.com | +380 67 123 4567</p>
                <p>🌐 <a href="#">Facebook</a> | <a href="#">Instagram</a> | <a href="#">LinkedIn</a></p>
            </footer>
        </nav>

        <!-- Центральна частина -->
        <main class="col-10 offset-2 p-4">
            <h2 class="mb-4">🎓 My Office</h2>

            <!-- Вкладки -->
            <ul class="nav nav-tabs" id="studentTabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button">📅 Schedule</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="materials-tab" data-bs-toggle="tab" data-bs-target="#materials" type="button">📂 Materials</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="progress-tab" data-bs-toggle="tab" data-bs-target="#progress" type="button">📊 Progress</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button">💳 Payments</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chat" type="button">💬 Chat</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="courses-tab" data-bs-toggle="tab" data-bs-target="#courses" type="button">📚 Courses</button>
                </li>
            </ul>

            <!-- Контент вкладок -->
            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="schedule" role="tabpanel">
                    <div id="scheduleContent">Loading...</div>
                </div>
                <div class="tab-pane fade" id="materials" role="tabpanel">
                    <div id="materialsContent">Loading...</div>
                </div>
                <div class="tab-pane fade" id="progress" role="tabpanel">
                    <div id="progressContent">Loading...</div>
                </div>
                <div class="tab-pane fade" id="payments" role="tabpanel">
                    <div id="paymentsContent">Loading...</div>
                </div>
                <div class="tab-pane fade" id="chat" role="tabpanel">
                    <div id="chatContent">Loading...</div>
                </div>
                <div class="tab-pane fade" id="courses" role="tabpanel">
                    <div id="coursesContent">Loading...</div>
                </div>

            </div>
        </main>
    </div>
</div>

@section Scripts {
        <script>
            function loadTabContent(tabId, url) {
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById(tabId).innerHTML = html;
                    });
            }

            // Завантажуємо Schedule при старті
            loadTabContent("scheduleContent", "/Student/ScheduleAll");

            // Підвантаження при кліку на вкладки
            document.getElementById("schedule-tab").addEventListener("click", () => {
                loadTabContent("scheduleContent", "/Student/ScheduleAll");
            });
            document.getElementById("materials-tab").addEventListener("click", () => {
                loadTabContent("materialsContent", "/Student/Materials");
            });
            document.getElementById("progress-tab").addEventListener("click", () => {
                loadTabContent("progressContent", "/Student/Progress");
            });
            document.getElementById("payments-tab").addEventListener("click", () => {
                loadTabContent("paymentsContent", "/Student/Payments");
            });
            document.getElementById("chat-tab").addEventListener("click", () => {
                //loadTabContent("chatContent", "/Student/Chat");
                loadTabContent("chatContent", "/Chat/Index");
            });
            document.getElementById("courses-tab").addEventListener("click", () => {
                loadTabContent("coursesContent", "/Student/Courses");
            });

            document.addEventListener("click", function(e) {
                const link = e.target.closest("a[data-chat]");
                if (link) {
                    e.preventDefault();
                    const url = link.getAttribute("href");
                    loadTabContent("chatContent", url);
                }
            });
            document.addEventListener("submit", function(e) {
                const form = e.target;
                if (form.id === "chatSearchForm") {
                    e.preventDefault();
                    const url = form.action + "?" + new URLSearchParams(new FormData(form));
                    loadTabContent("chatContent", url);
                }
                if (form.id === "sendMessageForm") {
                    e.preventDefault();
                    const formData = new FormData(form);
                    fetch(form.action, {
                        method: "POST",
                        body: formData
                    })
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById("chatContent").innerHTML = html;
                    });
                }
            });



        </script>
}
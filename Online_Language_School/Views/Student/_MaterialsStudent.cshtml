@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@model IEnumerable<Online_Language_School.Models.LessonMaterial>

<h4>📂 @Localizer["MyCourseMaterials"]</h4>

@if (Model != null && Model.Any())
{
    @foreach (var group in Model.GroupBy(m => m.Lesson.Course.Title))
    {
                <details class="mb-3">
                    <summary>@group.Key</summary>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>@Localizer["Title"]</th>
                                <th>@Localizer["Type"]</th>
                                <th>@Localizer["SizeKB"]</th>
                                <th>@Localizer["Lesson"]</th>
                                <th>@Localizer["Uploaded"]</th>
                                <th>@Localizer["Expiry"]</th>
                                <th>@Localizer["Actions"]</th>
                            </tr>
                        </thead>
                        <tbody>
                    @foreach (var material in group)
                    {
                                <tr>
                                    <td>@material.Title</td>
                                    <td>@material.FileType</td>
                                    <td>@(material.FileSize / 1024)</td>
                                    <td>@material.Lesson?.Title</td>
                                    <td>@material.UploadedAt.ToString("yyyy-MM-dd")</td>
                                    <td>@(material.ExpiryDate?.ToString("yyyy-MM-dd") ?? "-")</td>
                                    <td>
                                        <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#viewMaterial-@material.Id">
                                            👁 @Localizer["View"]
                                        </button>
                                        <a class="btn btn-sm btn-success" href="@material.FileUrl" download>
                                    @Localizer["Download"]
                                        </a>
                                    </td>
                                </tr>

                                <!-- Modal -->
                                <div class="modal fade" id="viewMaterial-@material.Id" tabindex="-1" aria-hidden="true">
                                    <div class="modal-dialog modal-md">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">@material.Title</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title">@Localizer["Lesson"]: @material.Lesson?.Title</h5>
                                                        <p class="card-text">@Localizer["Type"]: @material.FileType</p>
                                                        <ul class="list-group list-group-flush">
                                                            <li class="list-group-item">@Localizer["FileUrl"]: <a href="@material.FileUrl" target="_blank">@material.FileUrl</a></li>
                                                            <li class="list-group-item">@Localizer["Size"]: @(material.FileSize / 1024) KB</li>
                                                            <li class="list-group-item">@Localizer["Uploaded"]: @material.UploadedAt.ToString("yyyy-MM-dd")</li>
                                                            <li class="list-group-item">@Localizer["Expiry"]: @(material.ExpiryDate?.ToString("yyyy-MM-dd") ?? "-")</li>
                                                            <li class="list-group-item">@Localizer["MaterialId"]: @material.Id</li>
                                                            <li class="list-group-item">@Localizer["LessonId"]: @material.LessonId</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <a class="btn btn-primary" target="_blank" href="@material.FileUrl">@Localizer["Open"]</a>
                                                <a class="btn btn-success" href="@material.FileUrl" download>@Localizer["Download"]</a>
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                    }
                        </tbody>
                    </table>
                </details>
    }
}
else
{
        <p class="text-muted">@Localizer["NoMaterials"]</p>
}